<!DOCTYPE html>
 <html>
 <head>
   <style>
     body {
       font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
       padding: 16px;
       margin: 0;
       background: #ffffff;
       color: #000000;
     }
     .container {
       display: flex;
       flex-direction: column;
       gap: 16px;
     }
     h2 {
       margin: 0 0 8px 0;
       font-size: 14px;
       font-weight: 600;
       color: #000000;
     }
     .section {
       border-bottom: 1px solid #eaeaea;
       padding-bottom: 16px;
     }
     .section:last-child {
       border-bottom: none;
     }
     .instructions {
       font-size: 12px;
       color: #000000;
       line-height: 1.5;
     }
     textarea {
       width: 100%;
       min-height: 200px;
       padding: 8px;
       border: 1px solid #eaeaea;
       border-radius: 4px;
       font-family: monospace;
       font-size: 11px;
       resize: vertical;
       box-sizing: border-box;
       background: #ffffff;
       color: #000000;
     }
     textarea:focus {
       border-color: #b1d7fb;
       outline: none;
     }
     .button-group {
       display: flex;
       gap: 8px;
       margin-top: 8px;
     }
     button {
       flex: 1;
       padding: 10px 16px;
       border: none;
       border-radius: 4px;
       font-size: 12px;
       font-weight: 500;
       cursor: pointer;
       transition: background 0.2s;
     }
     .primary {
       background: #f15a24;
       color: #ffffff;
     }
     .primary:hover {
       background: #e87722;
     }
     .secondary {
       background: #eaeaea;
       color: #000000;
     }
     .secondary:hover {
       background: #b1d7fb;
       color: #000000;
     }
     .message {
       padding: 10px;
       border-radius: 4px;
       font-size: 12px;
       margin-top: 8px;
       display: none;
     }
     .message.success {
       background: #b1d7fb;
       color: #000000;
       display: block;
       border: 1px solid #eaeaea;
     }
     .message.error {
       background: #b1d7fb;
       color: #000000;
       display: block;
       border: 1px solid #eaeaea;
     }
     input[type="text"], input[type="checkbox"] {
       margin: 0;
     }
     input[type="text"] {
       width: 100%;
       padding: 6px 8px;
       border: 1px solid #eaeaea;
       border-radius: 4px;
       font-size: 12px;
       box-sizing: border-box;
       background: #ffffff;
       color: #000000;
     }
     input[type="text"]:focus {
       border-color: #b1d7fb;
       outline: none;
     }
     .row { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
     .row label { font-size: 12px; white-space: nowrap; color: #000000; }
   </style>
 </head>
 <body>
   <div class="container">
     <h2>PrincePost</h2>
     
     <!-- Get from web (default flow) -->
     <div class="section">
       <h3 style="font-size: 13px; margin: 0 0 8px 0;">Get from web</h3>
       <div class="instructions" style="margin-bottom: 8px;">
         Use the same workspace name as in the web app. Then click to load, or turn on auto-sync.
       </div>
       <label style="font-size: 12px; font-weight: 500;">Workspace name</label>
       <input type="text" id="workspaceName" placeholder="e.g. miriam or team-1" style="margin-top: 4px;">
       <label style="font-size: 12px; font-weight: 500; display: block; margin-top: 8px;">API URL (required)</label>
       <input type="text" id="apiUrl" value="https://princepost.vercel.app/" style="margin-top: 4px;">
       <small style="display: block; margin-top: 4px; color: #000000; font-size: 11px;">Points the API to the correct backend. You should not need to change this.</small>
       <div class="button-group" style="margin-top: 8px;">
         <button class="primary" id="getFromWeb">Get from web</button>
       </div>
       <div class="row" style="margin-top: 8px;">
         <input type="checkbox" id="autoSync">
         <label for="autoSync">Auto-sync (check to load new posts automatically while this panel is open)</label>
       </div>
     </div>
     
     <!-- JSON Input Section (manual paste) -->
     <div class="section">
       <h3 style="font-size: 13px; margin: 0 0 8px 0;">Or paste JSON (manual)</h3>
       <div class="instructions" style="margin-bottom: 8px;">
         Paste JSON to generate multiple slides from templates:
       </div>
       <textarea id="jsonInput" placeholder='{
   "slides": [
     {
       "template": "Two chunk quote",
       "texts": [
         "First quote with **highlighting**",
         "Second quote here"
       ],
       "speaker": "John Doe",
       "position": "CEO, Company"
     }
   ]
 }'></textarea>
       <div class="button-group">
         <button class="primary" id="processJson">Generate Slides</button>
       </div>
     </div>
     
     <div id="message" class="message"></div>
   </div>
 
   <script>
     const workspaceEl = document.getElementById('workspaceName');
     const apiUrlEl = document.getElementById('apiUrl');
     const getFromWebBtn = document.getElementById('getFromWeb');
     const autoSyncCheck = document.getElementById('autoSync');
     
     let autoSyncInterval = null;
     const AUTO_SYNC_MS = 10000;
     
     // Request saved workspace and API URL from main thread
     parent.postMessage({ pluginMessage: { type: 'get-storage' } }, '*');
     
     function getWorkspace() { return (workspaceEl && workspaceEl.value.trim()) || ''; }
     function getApiUrl() { return (apiUrlEl && apiUrlEl.value.trim()) ? apiUrlEl.value.trim().replace(/\/$/, '') : ''; }
     
     function saveStorage() {
       parent.postMessage({ pluginMessage: { type: 'set-storage', workspace: getWorkspace(), apiUrl: getApiUrl() } }, '*');
     }
     if (workspaceEl) workspaceEl.addEventListener('change', saveStorage);
     if (apiUrlEl) apiUrlEl.addEventListener('change', saveStorage);
     
     function fetchPayload(manual) {
       const workspace = getWorkspace();
       if (!workspace) {
         if (manual) showMessage('error', 'Enter workspace name');
         return;
       }
       parent.postMessage({ pluginMessage: { type: 'fetch-payload', workspace, apiUrl: getApiUrl(), manual } }, '*');
     }
     
     getFromWebBtn.onclick = () => fetchPayload(true);
     
     autoSyncCheck.onchange = () => {
       if (autoSyncInterval) clearInterval(autoSyncInterval);
       autoSyncInterval = null;
       if (autoSyncCheck.checked) {
         fetchPayload(false);
         autoSyncInterval = setInterval(() => fetchPayload(false), AUTO_SYNC_MS);
       }
     };
     
     document.getElementById('processJson').onclick = () => {
       const jsonText = document.getElementById('jsonInput').value.trim();
       if (!jsonText) {
         showMessage('error', 'Please enter JSON');
         return;
       }
       parent.postMessage({ pluginMessage: { type: 'process-json', json: jsonText } }, '*');
     };
     
     function showMessage(type, text) {
       const messageEl = document.getElementById('message');
       messageEl.className = 'message ' + type;
       messageEl.textContent = (type === 'success' ? '✓ ' : '✗ ') + text;
       setTimeout(() => { messageEl.className = 'message'; }, 5000);
     }
     
     window.onmessage = (event) => {
       const msg = event.data.pluginMessage;
       if (!msg) return;
       if (msg.type === 'success' || msg.type === 'error') {
         showMessage(msg.type, msg.message);
       } else if (msg.type === 'storage') {
         if (workspaceEl && msg.workspace != null) workspaceEl.value = msg.workspace;
         if (apiUrlEl && msg.apiUrl != null) apiUrlEl.value = msg.apiUrl;
       }
     };
   </script>
 </body>
 </html>